<!DOCTYPE html>
<html>
<head>
  <title>KolamConnect Demo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    h2 {
      color: #333;
    }
    button {
      margin-top: 10px;
      padding: 8px 15px;
      border: none;
      background-color: #4CAF50;
      color: white;
      cursor: pointer;
      border-radius: 5px;
    }
    button:hover {
      background-color: #45a049;
    }
    .section {
      margin-bottom: 40px;
    }
    img {
      margin-top: 15px;
      border: 2px solid #ddd;
      border-radius: 5px;
      padding: 5px;
      max-width: 400px;
    }
    .gallery {
      display: flex;
      gap: 20px;
      margin-top: 20px;
    }
    .gallery div {
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>KolamConnect Prototype</h1>

  <!-- ✅ Section 1: Upload & Digitize -->
  <div class="section">
    <h2>Upload a Kolam Image</h2>
    <input type="file" name="image" id="fileInput" />
    <button type="button" id="uploadBtn">Upload & Process</button>
    <div id="uploadResult"></div>
  </div>

  <!-- ✅ Section 2: Generate Kolam (manual input, optional) -->
  <div class="section">
    <h2>Generate a Kolam</h2>
    <label for="rows">Rows:</label>
    <input type="number" id="rows" value="6" min="3" max="12">
    <label for="cols">Cols:</label>
    <input type="number" id="cols" value="6" min="3" max="12">
    <button type="button" id="generateBtn">Generate</button>
    <div id="generateResult"></div>
  </div>

  <script>
    // ✅ Prevent page refresh
    document.addEventListener("submit", function(e) {
      e.preventDefault();
    });

    // ✅ Upload & Digitize
    const uploadBtn = document.getElementById("uploadBtn");
    uploadBtn.addEventListener("click", async () => {
      const fileInput = document.getElementById("fileInput");
      if (!fileInput.files[0]) {
        alert("Please choose a file first!");
        return;
      }

      const formData = new FormData();
      formData.append("image", fileInput.files[0]);

      try {
        const backend = "https://kolam-backend.onrender.com"; // Replace with your Render URL
        const response = await fetch(`${backend}/process`, {
          method: "POST",
          body: formData,
        });

        const result = await response.json();
        console.log("Upload Response:", result);

        if (result.digitized && result.original) {
          // Build variations gallery
          let variationsHTML = "<h3>Generated Variations</h3><div class='gallery'>";
          result.variations.forEach((url, idx) => {
            variationsHTML += `
              <div>
                <p><b>Variation ${idx+1}</b></p>
                <img src="${url}" width="250"/>
              </div>
            `;
          });
          variationsHTML += "</div>";

          // Show before/after + variations
          document.getElementById("uploadResult").innerHTML = `
            <h3>Before vs After</h3>
            <div style="display:flex; gap:20px;">
              <div>
                <p><b>Original Kolam</b></p>
                <img src="${result.original}" width="250"/>
              </div>
              <div>
                <p><b>Digitized Kolam</b></p>
                <img src="${result.digitized}" width="250"/>
              </div>
            </div>
            ${variationsHTML}
          `;
        } else {
          document.getElementById("uploadResult").innerText =
            "Error: " + JSON.stringify(result);
        }

      } catch (err) {
        console.error("Upload error:", err);
        document.getElementById("uploadResult").innerText = "Upload failed.";
      }
    });

    // ✅ Manual Generate Kolam
    const generateBtn = document.getElementById("generateBtn");
    generateBtn.addEventListener("click", async () => {
      const rows = document.getElementById("rows").value;
      const cols = document.getElementById("cols").value;

      try {
        const backend = "https://kolam-backend.onrender.com"; // Replace with your Render URL
        const response = await fetch(`${backend}/generate?rows=${rows}&cols=${cols}`);
        const result = await response.json();
        console.log("Generate Response:", result);

        if (result.generated) {
          document.getElementById("generateResult").innerHTML =
            `<h3>Generated Kolam:</h3>
             <img src="${result.generated}" width="400"/>`;
        } else {
          document.getElementById("generateResult").innerText =
            "Error: " + JSON.stringify(result);
        }
      } catch (err) {
        console.error("Generate error:", err);
        document.getElementById("generateResult").innerText = "Generation failed.";
      }
    });
  </script>
</body>
</html>
